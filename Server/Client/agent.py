from flask import * 
import time
import os
import threading

app = Flask(__name__)  
 
@app.route('/')  
def upload():  
    return render_template("file_upload_form.html")  
global file_Name
@app.route('/success', methods = ['POST'])  
def success():  
    if request.method == 'POST':  
        f = request.files['file']
        f.save((os.path.join("C:\Users\IEUser\Desktop\Server\NtTrace", f.filename)))
        global file_Name
        file_Name = f.filename
        #f.save(f.filename)
        t1 = threading.Thread(target = NtTrace_Start)
        t1.start()
        time.sleep(0.1)
        t2 = threading.Thread(target = kill_App)
        t2.start()
        os.chdir("C:\Users\IEUser\Desktop\Server")
        os.system("python client.py") 
        return render_template("success.html", name = f.filename)  
  
if __name__ == '__main__':  
    app.run(debug = True)
def NtTrace_Start():
        global file_Name
        os.chdir("C:\Users\IEUser\Desktop\Server\NtTrace")
        trace_CMD = "NtTrace.exe -out output.txt " + file_Name
        os.system(trace_CMD)

def kill_App():
        global file_Name
        command_Kill = "taskkill /f /im " +  file_Name
        os.system(command_Kill)
